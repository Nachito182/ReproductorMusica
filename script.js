const albumSongs = {
    "paho" : [
        { title: "You", duration: "3:28", file: "songs/paho/01.mp3" },
        { title: "Creep", duration: "3:55", file: "songs/paho/02.mp3" },
        { title: "How Do You?", duration: "2:12", file: "songs/paho/03.mp3" },
        { title: "Stop Whispering", duration: "5:25", file: "songs/paho/04.mp3" },
        { title: "Thinking About You", duration: "2:41", file: "songs/paho/05.mp3" },
        { title: "Anyone Can Play Guitar", duration: "3:37", file: "songs/paho/06.mp3" },
        { title: "Ripcord", duration: "3:09", file: "songs/paho/07.mp3" },
        { title: "Vegetable", duration: "3:12", file: "songs/paho/08.mp3" },
        { title: "Prove Yourself", duration: "2:25", file: "songs/paho/09.mp3" },
        { title: "I Can't", duration: "4:13", file: "songs/paho/10.mp3" },
    ],

    "thbe" : [
        { title: "Planet Telex", duration: "4:19", file: "songs/thbe/01.mp3" },
        { title: "The Bends", duration: "4:05", file: "songs/thbe/02.mp3" },
        { title: "High and Dry", duration: "4:17", file: "songs/thbe/03.mp3" },
        { title: "Fake Plastic Trees", duration: "4:51", file: "songs/thbe/04.mp3" },
        { title: "Bones", duration: "3:06", file: "songs/thbe/05.mp3" },
        { title: "Nice Dream", duration: "3:52", file: "songs/thbe/06.mp3" },
        { title: "Just", duration: "3:54", file: "songs/thbe/07.mp3" },
        { title: "My Iron Lung", duration: "4:13", file: "songs/thbe/08.mp3" },
        { title: "Bullet Proof... I Wish I Was", duration: "4:28", file: "songs/thbe/09.mp3" },
        { title: "Black Star", duration: "4:09", file: "songs/thbe/10.mp3" },
        { title: "Sulk", duration: "4:19", file: "songs/thbe/11.mp3" },
        { title: "Street Spirit (Fade Out)", duration: "4:12", file: "songs/thbe/12.mp3" },
    ],
    
    "okco" : [
        { title: "Airbag", duration: "4:44", file: "songs/okco/01.mp3" },
        { title: "Paranoid Android", duration: "6:23", file: "songs/okco/02.mp3" },
        { title: "Subterranean Homesick Alien", duration: "4:27", file: "songs/okco/03.mp3" },
        { title: "Exit Music (For a Film)", duration: "4:24", file: "songs/okco/04.mp3" },
        { title: "Let Down", duration: "4:59", file: "songs/okco/05.mp3" },
        { title: "Karma Police", duration: "4:21", file: "songs/okco/06.mp3" },
        { title: "Fitter Happier", duration: "1:57", file: "songs/okco/07.mp3" },
        { title: "Electioneering", duration: "3:50", file: "songs/okco/08.mp3" },
        { title: "Climbing Up the Walls", duration: "4:45", file: "songs/okco/09.mp3" },
        { title: "No Surprises", duration: "3:48", file: "songs/okco/10.mp3" },
        { title: "Lucky", duration: "4:19", file: "songs/okco/11.mp3" },
        { title: "The Tourist", duration: "5:24", file: "songs/okco/12.mp3" },
    ],
    
    "kida" : [
        { title: "Everything in Its Right Place", duration: "4:11", file: "songs/kida/01.mp3" },
        { title: "Kid A", duration: "4:44", file: "songs/kida/02.mp3" },
        { title: "The National Anthem", duration: "5:51", file: "songs/kida/03.mp3" },
        { title: "How to Disappear Completely", duration: "5:56", file: "songs/kida/04.mp3" },
        { title: "Treefingers", duration: "3:42", file: "songs/kida/05.mp3" },
        { title: "Optimistic", duration: "5:15", file: "songs/kida/06.mp3" },
        { title: "In Limbo", duration: "3:31", file: "songs/kida/07.mp3" },
        { title: "Idioteque", duration: "5:09", file: "songs/kida/08.mp3" },
        { title: "Morning Bell", duration: "4:35", file: "songs/kida/09.mp3" },
        { title: "Motion Picture Soundtrack", duration: "7:01", file: "songs/kida/10.mp3" },
    ],
    
    "amn" : [
        { title: "Packt Like Sardines in a Crushd Tin Box", duration: "4:00", file: "songs/amn/01.mp3" },
        { title: "Pyramid Song", duration: "4:48", file: "songs/amn/02.mp3" },
        { title: "Pulk/Pull Revolving Doors", duration: "4:07", file: "songs/amn/03.mp3" },
        { title: "You and Whose Army?", duration: "3:10", file: "songs/amn/04.mp3" },
        { title: "I Might Be Wrong", duration: "4:53", file: "songs/amn/05.mp3" },
        { title: "Knives Out", duration: "4:14", file: "songs/amn/06.mp3" },
        { title: "Morning Bell/Amnesiac", duration: "3:14", file: "songs/amn/07.mp3" },
        { title: "Dollars + Cents", duration: "4:51", file: "songs/amn/08.mp3" },
        { title: "Hunting Bears", duration: "2:01", file: "songs/amn/09.mp3" },
        { title: "Like Spinning Plates", duration: "3:57", file: "songs/amn/10.mp3" },
        { title: "Life in a Glasshouse", duration: "4:36", file: "songs/amn/11.mp3" },
    ],
    
    "httt" : [
        { title: "2+2=5", duration: "3:21", file: "songs/httt/01.mp3" },
        { title: "Sit Down. Stand Up.", duration: "4:19", file: "songs/httt/02.mp3" },
        { title: "Sail to the Moon", duration: "4:32", file: "songs/httt/03.mp3" },
        { title: "Backdrifts", duration: "4:43", file: "songs/httt/04.mp3" },
        { title: "Go to Sleep", duration: "3:21", file: "songs/httt/05.mp3" },
        { title: "Where I End and You Begin", duration: "4:30", file: "songs/httt/06.mp3" },
        { title: "We Suck Young Blood", duration: "4:58", file: "songs/httt/07.mp3" },
        { title: "The Gloaming", duration: "3:30", file: "songs/httt/08.mp3" },
        { title: "There There", duration: "5:25", file: "songs/httt/09.mp3" },
        { title: "I Will", duration: "1:59", file: "songs/httt/10.mp3" },
        { title: "A Punchup at a Wedding", duration: "4:45", file: "songs/httt/11.mp3" },
        { title: "Myxomatosis", duration: "3:50", file: "songs/httt/12.mp3" },
        { title: "Scatterbrain", duration: "3:21", file: "songs/httt/13.mp3" },
        { title: "A Wolf at the Door", duration: "3:23", file: "songs/httt/14.mp3" },
    ],
    
    "inra" : [
        { title: "15 Step", duration: "3:57", file: "songs/inra/01.mp3" },
        { title: "Bodysnatchers", duration: "4:02", file: "songs/inra/02.mp3" },
        { title: "Nude", duration: "4:15", file: "songs/inra/03.mp3" },
        { title: "Weird Fishes/Arpeggi", duration: "5:18", file: "songs/inra/04.mp3" },
        { title: "All I Need", duration: "3:48", file: "songs/inra/05.mp3" },
        { title: "Faust Arp", duration: "2:10", file: "songs/inra/06.mp3" },
        { title: "Reckoner", duration: "4:50", file: "songs/inra/07.mp3" },
        { title: "House of Cards", duration: "5:28", file: "songs/inra/08.mp3" },
        { title: "Jigsaw Falling Into Place", duration: "4:09", file: "songs/inra/09.mp3" },
        { title: "Videotape", duration: "4:42", file: "songs/inra/10.mp3" },
    ],
    
    "tkol" : [
        { title: "Bloom", duration: "5:15", file: "songs/tkol/01.mp3" },
        { title: "Morning Mr Magpie", duration: "4:41", file: "songs/tkol/02.mp3" },
        { title: "Little by Little", duration: "4:28", file: "songs/tkol/03.mp3" },
        { title: "Feral", duration: "3:13", file: "songs/tkol/04.mp3" },
        { title: "Lotus Flower", duration: "5:01", file: "songs/tkol/05.mp3" },
        { title: "Codex", duration: "4:47", file: "songs/tkol/06.mp3" },
        { title: "Give Up the Ghost", duration: "4:50", file: "songs/tkol/07.mp3" },
        { title: "Separator", duration: "5:20", file: "songs/tkol/08.mp3" },
    ],
    
    "amsp" : [
        { title: "Burn the Witch", duration: "3:40", file: "songs/amsp/01.mp3" },
        { title: "Daydreaming", duration: "6:40", file: "songs/amsp/02.mp3" },
        { title: "Decks Dark", duration: "4:43", file: "songs/amsp/03.mp3" },
        { title: "Desert Island Disk", duration: "3:44", file: "songs/amsp/04.mp3" },
        { title: "Ful Stop", duration: "6:56", file: "songs/amsp/05.mp3" },
        { title: "Glass Eyes", duration: "2:52", file: "songs/amsp/06.mp3" },
        { title: "Identikit", duration: "4:35", file: "songs/amsp/07.mp3" },
        { title: "The Numbers", duration: "4:12", file: "songs/amsp/08.mp3" },
        { title: "Present Tense", duration: "4:25", file: "songs/amsp/09.mp3" },
        { title: "Tinker Tailor Soldier Sailor Rich Man Poor Man Beggar Man Thief", duration: "5:03", file: "songs/amsp/10.mp3" },
        { title: "True Love Waits", duration: "4:43", file: "songs/amsp/11.mp3" },
    ],
}

function getAlbumIdFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get("album");
}


let currentIndex = 0;
let isPlaying = false;
let isShuffled = false;

const audio = new Audio();
const songListContainer = document.getElementById("song-list");
const progressBar = document.querySelector(".progress-bar");
const progressContainer = document.querySelector(".progress-container");
const currentTimeSpan = document.getElementById("current-time");
const durationSpan = document.getElementById("duration");
const currentTitle = document.getElementById("current-title");


function loadSongs() {
    const albumId = getAlbumIdFromURL();
    const songs = albumSongs[albumId] || [];
    songs.forEach((song, index) => {
        const songDiv = document.createElement("div");
        songDiv.classList.add("song");
        songDiv.innerHTML = `<span>${song.title}</span><span>${song.duration}</span>`;
        songDiv.onclick = () => {
            currentIndex = index;
            loadAndPlaySong();
        };
        songListContainer.appendChild(songDiv);
    });
}

function loadAndPlaySong() {
    const albumId = getAlbumIdFromURL();
    const songs = albumSongs[albumId] || [];
    
    // Si es una nueva canción, reiniciar el tiempo a 0
    if (audio.src !== songs[currentIndex].file) {
        audio.src = songs[currentIndex].file;
        audio.currentTime = 0; // Reinicia la reproducción al inicio
    }

    audio.play();
    isPlaying = true;
    updateSongDisplay();
    updatePlayIcon();
}


function getFileName(path) {
    try {
        const url = new URL(path);
        return decodeURIComponent(url.pathname.replace(/^.*\/songs\//, "songs/")); // Mantiene la estructura desde "songs/"
    } catch (error) {
        return path.replace(/^.*\/songs\//, "songs/"); // Respaldo en caso de error
    }
}
function playSong() {
    const albumId = getAlbumIdFromURL();
    const songs = albumSongs[albumId] || [];
    const currentFile = songs[currentIndex].file;
    
    // Guardar la posición actual antes de cambiar de canción
    let savedTime = audio.currentTime;

    if (!audio.src || audio.src !== currentFile) {
        audio.src = currentFile; // Solo cambia si es una nueva canción
        audio.onloadeddata = () => {
            audio.currentTime = savedTime; // Restaurar la posición
            audio.play();
        };
    } else if (audio.paused) {
        audio.play(); // Si está pausado, simplemente reanudar
    }

    isPlaying = true;
    updatePlayIcon();
    updateSongDisplay();
}

function updatePlayIcon() {
    const playButtonIcon = document.querySelector("#play i");
    if (isPlaying) {
        playButtonIcon.classList.remove("bi-play-fill");
        playButtonIcon.classList.add("bi-pause-fill");
    } else {
        playButtonIcon.classList.remove("bi-pause-fill");
        playButtonIcon.classList.add("bi-play-fill");
    }
}

// Evento para pasar a la siguiente canción al terminar la actual
audio.onended = () => {
    nextSong();
};

function pauseSong() {
    audio.pause();
    isPlaying = false;
    updatePlayIcon();
}

function updateSongDisplay() {
    const albumId = getAlbumIdFromURL();
    const songs = albumSongs[albumId] || [];
    const allSongs = document.querySelectorAll(".song");
    allSongs.forEach((el, i) => {
        el.classList.toggle("playing", i === currentIndex);
    });
    currentTitle.textContent = songs[currentIndex].title;
}

function nextSong() {
    const albumId = getAlbumIdFromURL();
    const songs = albumSongs[albumId] || [];
    if (isShuffled) {
        let newIndex;
        do {
            newIndex = Math.floor(Math.random() * songs.length);
        } while (newIndex === currentIndex);
        currentIndex = newIndex;
    } else {
        currentIndex = (currentIndex + 1) % songs.length;
    }
    loadAndPlaySong();
}

function prevSong() {
    const albumId = getAlbumIdFromURL();
    const songs = albumSongs[albumId] || [];
    currentIndex = (currentIndex - 1 + songs.length) % songs.length;
    loadAndPlaySong();
}

function toggleShuffle() {
    isShuffled = !isShuffled;
    alert("Modo aleatorio: " + (isShuffled ? "activado" : "desactivado"));
}

// Actualiza barra de progreso
audio.ontimeupdate = () => {
    const progressPercent = (audio.currentTime / audio.duration) * 100;
    progressBar.style.width = progressPercent + "%";
    currentTimeSpan.textContent = formatTime(audio.currentTime);
    durationSpan.textContent = formatTime(audio.duration);
};

function formatTime(time) {
    if (isNaN(time)) return "0:00";
    const min = Math.floor(time / 60);
    const sec = Math.floor(time % 60).toString().padStart(2, "0");
    return `${min}:${sec}`;
}

// Hacer clic en la barra para saltar a un tiempo
progressContainer.addEventListener("click", (e) => {
    const rect = progressContainer.getBoundingClientRect();
    const clickX = e.pageX - rect.left - window.scrollX; // más preciso en caso de scroll
    const width = rect.width;
    const duration = audio.duration;

    // Garantiza que el click esté dentro del ancho permitido
    const percent = Math.min(Math.max(clickX / width, 0), 1);
    audio.currentTime = percent * duration;
});



document.getElementById("play").onclick = () => {
    if (isPlaying) {
        pauseSong();
    } else {
        playSong();
    }
};
document.getElementById("next").onclick = nextSong;
document.getElementById("prev").onclick = prevSong;
document.getElementById("shuffle").onclick = toggleShuffle;
document.getElementById("repeat").onclick = () => {
    audio.currentTime = 0;
    playSong();
};

loadSongs();


